@page "/payment"
@inject NavigationManager navigationManager
@inject NavigationManager NavManager

<PageTitle>Payment</PageTitle>
<div class="bg-dark header-image">
<center><img class src="https://burnham-highbridge-tc.gov.uk/wp-content/uploads/2021/06/TVL-Logo-Black.jpg" style="width:600px;height:150px;"></center>
<div class="d-flex flex-row justify-content-around py-3 header-sub-bar">
<NavLink class="nav-link" href="/">
<svg xmlns="http://www.w3.org/2000/svg" width="47" height="47" fill="white" class="bi bi-cash mb-2" viewBox="0 0 16 16"> 
  <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
  <path d="M0 4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V4zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V6a2 2 0 0 1-2-2H3z"/> </svg>  
<span class="mx-3 fs-3 fw-bold text-white header-link1" aria-hidden="true"> Pay Fine </span>
</NavLink>
<NavLink class="nav-link" href="contact">
                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="white" class="bi bi-chat-left-text" viewBox="0 0 16 16">
  <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
  <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/> </svg>
                <span class="mx-3 fs-3 fw-bold text-white header-link2" aria-hidden="true">Contact Us</span>
            </NavLink>
</div>
</div>

<h1 class="my-5 py-3 fs-1 fw-bold">Payment</h1>
<div class="lh-lg fs-3 my-3">Enter your payment details below:</div>
<EditForm Model="@paymentDetails" OnValidSubmit="@HandleValidSubmit">
<DataAnnotationsValidator/>
<ValidationSummary/>
<p>@check</p>
<input class="form-control form-control-lg my-5 py-3" type="text" placeholder="Name on Card" @bind="paymentDetails.cardName" />
<input class="form-control form-control-lg my-5 py-3" type="text" placeholder="Card Number" @bind="paymentDetails.cardNumber" />
<input class="form-control form-control-lg my-5 py-3" type="text" placeholder="Expiry Date" @bind="paymentDetails.expDate" />
<input class="form-control form-control-lg my-5 py-3" type="text" placeholder="CVC" @bind="paymentDetails.cvc" />
<button type = "submit" class="btn btn-success my-4 ms-5 px-4 py-2 fw-bold border border-dark border border-3">Check Details</button>
 <button type="button" class="btn btn-danger my-4 ms-5 px-5 py-2 fw-bold border border-dark border border-3" @onclick="SubmitDetails">Pay Now</button>

</EditForm>

@code
{
  private string? maskedString;
  private string? unmaskedString;
  private string? check;
  private PaymentDetails paymentDetails = new();

  private void SubmitDetails()
  {
    unmaskedString = paymentDetails.cardNumber;

    if(paymentDetails.cardNumber != null && paymentDetails.cardName != null && paymentDetails.expDate != null && paymentDetails.cvc != null)
    {
         if (unmaskedString != null)
        {
          maskedString = new string('*', 12) + unmaskedString.Substring(12);
        }

        navigationManager.NavigateTo($"/SummaryPayment/{maskedString}");
        check = string.Empty;
    }  
    else 
    {
        check = "All fields are MANDATORY, please try again.";
    }

    
  }


  private void HandleValidSubmit()
  {
    if(paymentDetails.cardNumber != null && paymentDetails.cardName != null && paymentDetails.expDate != null && paymentDetails.cvc != null)
    {
         check = string.Empty;
    }  
    else 
    {
        check = "Couldn't match your details, please try again.";
    }
  }

}